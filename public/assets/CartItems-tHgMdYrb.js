import{u as ee,j as e,M as h,R as x,C as c,r as o,a as se,b as I,H as ne,F as R,c as ae,I as te,d as re,S as ce,e as a,B as M,f as $,g as m}from"./index-C7u28dO1.js";const le=({show:v,onHide:p,paymentDetails:j})=>{const{userName:u,userEmail:f,cartItems:t,grandTotal:z,referenceNumber:T}=j,g=ee(),B=(z/100).toFixed(2),b=()=>{p(),g("/")};return e.jsx(h,{show:v,onHide:p,centered:!0,className:"paymentConfirmModal",children:e.jsxs(h.Body,{className:"paymentconfirmbody",children:[e.jsx("h4",{className:"text-center ptcText pb-4",children:"Your order has been confirmed!"}),e.jsx(x,{className:"mb-4",style:{borderBottom:"2px solid #000",padding:"2px 0"},children:e.jsxs(c,{xs:12,children:[e.jsxs("p",{className:"paymentUserInfo",children:[e.jsx("strong",{className:"paymentUserDetails me-2",children:"Name:"})," ",u||"Guest"]}),e.jsxs("p",{className:"paymentUserInfo",children:[e.jsx("strong",{className:"paymentUserDetails me-2",children:"Reference number:"})," ",T]}),e.jsxs("p",{className:"paymentUserInfo",children:[e.jsx("strong",{className:"paymentUserDetails me-2",children:"Email:"})," ",f||"Not provided"]})]})}),t.map((l,S)=>{var w,N;return e.jsx("div",{className:"mb-3",style:{borderBottom:"2px solid #000",padding:"2px 0"},children:e.jsxs(x,{children:[e.jsxs(c,{xs:8,children:[e.jsx("h6",{className:"pcName",children:(w=l==null?void 0:l.product)==null?void 0:w.name}),e.jsxs("p",{className:"pcSizeQty",children:["Size: ",(N=l==null?void 0:l.product_variant)==null?void 0:N.variant_size,"   |   Qty: ",l==null?void 0:l.quantity]})]}),e.jsx(c,{xs:4,className:"text-end",children:e.jsx("h6",{className:"pcPrice",children:l==null?void 0:l.price})})]})},S)}),e.jsxs(x,{className:"my-3",children:[e.jsx(c,{xs:8,children:e.jsx("h5",{className:"paymentamountTotal",children:"Amount Paid"})}),e.jsx(c,{xs:4,className:"text-end",children:e.jsxs("h5",{className:"paymentamountTotal",children:["₹",B]})})]}),e.jsx("div",{className:"my-3 d-flex justify-content-center align-items-center",children:e.jsx("button",{className:"paymentConfirmButton",onClick:b,children:"Return Home"})})]})})},oe=({show:v,onHide:p,onTryAgain:j})=>e.jsx(h,{show:v,onHide:p,centered:!0,className:"paymentrejectModal",children:e.jsxs(h.Body,{className:"paymentrejectbody",children:[e.jsx("h4",{className:"text-center ptrText pb-4",children:"Payment Unsuccessful"}),e.jsx(x,{children:e.jsx(c,{xs:12,className:"d-flex justify-content-center align-items-center",children:e.jsx("p",{className:"paymentRejectedText text-center",children:"Oops! Your payment didn't go through. Please attempt again."})})}),e.jsxs("div",{className:"my-3 d-flex justify-content-between align-items-center",children:[e.jsx("button",{className:"paymentRejectedButton trButton",onClick:p,children:"Cancel"}),e.jsx("button",{className:"paymentRejectedButton",onClick:j,children:"Try Again"})]})]})}),de=()=>{const{removeFromCart:v,setCart:p,cartId:j}=o.useContext(se),[u,f]=o.useState([]),[t,z]=o.useState(null),[T,g]=o.useState(!1),[B,b]=o.useState(!0),[l,S]=o.useState(null),[w,N]=o.useState(null),[U,_]=o.useState(null),[k,q]=o.useState(!1),[L,F]=o.useState(!1),[O,Y]=o.useState({userName:"",userEmail:"",cartItems:[],grandTotal:0,referenceNumber:""}),[G,H]=o.useState(!1),[r,y]=o.useState({name:"",contact_no:"",email:"",address:"",landmark:"",city:"",pincode:"",state:"",country:"India",category:"Home"}),D=localStorage.getItem("access_token"),A="https://dhya.one/hht",J=async()=>{try{const s=await $.get(`${A}/merchant/cart/${j}`,{headers:{Authorization:`Bearer ${D}`}});f(s.data.data.items),b(!1)}catch(s){console.error("Error fetching cart data:",s),m.error("Failed to fetch cart items."),b(!1)}},K=()=>{localStorage.setItem("address",JSON.stringify(r)),z(r),g(!1),m.success("Address saved successfully!")},V=async s=>{if(s.quantity>=10){m.error("Quantity should not exceed beyond 10.");return}S(s.ID);try{const n=s.quantity+1;await $.put(`${A}/merchant/cartItem/${s.ID}`,{ID:s.ID,quantity:n},{headers:{Authorization:`Bearer ${D}`}}),f(u.map(i=>i.ID===s.ID?{...i,quantity:n}:i))}catch(n){console.error("Error increasing quantity:",n),m.error("Failed to increase quantity.")}finally{S(null)}},W=async s=>{if(s.quantity<=1){m.error("Quantity cannot be less than 1.");return}N(s.ID);try{const n=s.quantity-1;await $.put(`${A}/merchant/cartItem/${s.ID}`,{ID:s.ID,quantity:n},{headers:{Authorization:`Bearer ${D}`}}),f(u.map(i=>i.ID===s.ID?{...i,quantity:n}:i))}catch(n){console.error("Error decreasing quantity:",n),m.error("Failed to decrease quantity.")}finally{N(null)}},X=async s=>{_(s);try{await $.delete(`${A}/merchant/cartItem/${s}`,{headers:{Authorization:`Bearer ${D}`}}),f(u.filter(n=>n.ID!==s))}catch(n){console.error("Error removing item from cart:",n),m.error("Failed to remove item.")}finally{_(null)}},E=u.reduce((s,n)=>s+n.price*n.quantity,0);o.useEffect(()=>{j&&J()},[j]);const Z=()=>new Promise(s=>{const n=document.createElement("script");n.src="https://checkout.razorpay.com/v1/checkout.js",n.onload=()=>{s(!0)},n.onerror=()=>{s(!1)},document.body.appendChild(n)}),Q=async()=>{if(!t){m.error("Please select or add a delivery address before proceeding to payment.");return}if(!await Z()){m.error("Failed to load Razorpay script. Please try again.");return}H(!0);const n=u.map(d=>{var P;return`${d.product.name} (Size: ${(P=d.product_variant)==null?void 0:P.variant_size}, Qty: ${d.quantity})`}).join(", "),i={key:"rzp_live_0RCB5tOm2H2EYq",amount:(E+199)*100,currency:"INR",name:"HHT Entertainment",description:"Purchase Order",image:"https://hiphoptamizha.com/assets/hhtlogo-C5v3yLtg.png",handler:function(d){const P={userName:t.name,userEmail:t.email,cartItems:u,grandTotal:(E+199)*100,referenceNumber:d.razorpay_payment_id};Y(P),q(!0),p([]),m.success("Payment successful! Payment ID: "+d.razorpay_payment_id)},prefill:{name:t.name,email:t.email,contact:t.contact_no},notes:{address:`${t.address}, ${t.city}, ${t.state}, ${t.country}, ${t.pincode}`,cart_items:n},theme:{color:"#3399cc"}},C=new window.Razorpay(i);C.on("payment.failed",function(d){F(!0),console.error("Payment failed! Error: ",d),m.error("Payment failed! Error: "+d.error.description)}),C.open(),H(!1)};return e.jsxs(I,{fluid:!0,className:"cartContainer",children:[e.jsx(ne,{backgroundColor:"#3EA66B",color:"#F4E003",name:"Cart"}),B?e.jsx(x,{className:"d-flex justify-content-center align-items-center my-5",children:e.jsx(c,{className:"d-flex justify-content-center align-items-center",children:e.jsx(R,{className:"loadingSpinner"})})}):u.length>0?e.jsxs(I,{children:[e.jsx(x,{className:"mt-3 d-flex justify-content-center justify-content-sm-end align-items-center",children:e.jsxs(c,{xs:12,className:"addressColumn d-flex justify-content-between align-items-center my-3",children:[e.jsx("div",{className:"deliverContainer p-0 m-0 w-100",children:e.jsxs("p",{className:"p-0 m-0 deliverText",children:["Deliver to: ",t?`${t.name}, ${t.address}, ${t.city}, ${t.pincode}`:"No address selected"]})}),e.jsx("div",{className:"changeAddressContainer",children:e.jsx("p",{className:"changeAddressText",onClick:()=>g(!0),children:t?"Change Address":"Add Address"})})]})}),u.map(s=>{var n,i,C,d;return e.jsx(ae.Fragment,{children:e.jsx(x,{className:"my-3 d-flex justify-content-center align-items-center",children:e.jsx(c,{xs:12,className:"cartImageRow",children:e.jsxs(x,{children:[e.jsx(c,{xs:4,lg:3,className:"cartImageColumn",children:e.jsx("div",{className:"cartImageContainer",children:((i=(n=s==null?void 0:s.product)==null?void 0:n.images)==null?void 0:i.length)>0?e.jsx(te,{fluid:!0,src:s.product.images[0].image_url,alt:"product-image",className:"crtImage"}):null})}),e.jsxs(c,{xs:6,lg:7,className:"cartDetails m-0 p-0",children:[e.jsx("p",{className:"cartprName p-0 m-0",children:(C=s==null?void 0:s.product)==null?void 0:C.name}),e.jsxs("div",{className:"d-flex justify-content-start align-items-center w-100 my-1",children:[e.jsx("div",{className:"ssSizeContainer d-flex align-items-center",children:e.jsxs("p",{className:"m-0 p-0",children:["Size: ",(d=s==null?void 0:s.product_variant)==null?void 0:d.variant_size]})}),e.jsxs("div",{className:"ssSizeContainer d-flex align-items-center",children:[e.jsx("p",{className:"m-0 p-0",children:"Qty"}),e.jsxs("div",{className:"d-flex align-items-center justify-content-between ms-2",children:[e.jsx("p",{className:"m-0 px-1 actionicon",onClick:()=>W(s),children:w===s.ID?e.jsx(R,{className:"loadingSpinner"}):"-"}),e.jsx("p",{className:"m-0 px-1",children:s.quantity}),e.jsx("p",{className:"m-0 px-1 actionicon",onClick:()=>V(s),children:l===s.ID?e.jsx(R,{className:"loadingSpinner"}):"+"})]})]})]}),e.jsxs("p",{className:"cartprprice p-0 m-0 mt-1 mt-md-3 d-flex justify-content-start align-items-center",children:["₹",s==null?void 0:s.price]})]}),e.jsx(c,{xs:2,lg:2,className:"cartDetailsIcon d-flex align-items-start justify-content-end",children:U===s.ID?e.jsx(R,{className:"loadingSpinner"}):e.jsx(re,{className:"closeIcon",onClick:()=>X(s.ID)})})]})})})},s.ID)}),e.jsxs(x,{className:"my-4 d-flex justify-content-center align-items-center",children:[e.jsx(c,{xs:12,className:"cartPriceRow",children:e.jsx("h4",{className:"pricedetailtext",children:"Price Details"})}),e.jsxs(c,{xs:12,className:"cartPriceRow",children:[e.jsxs("div",{className:"cartTotalContainer d-flex align-items-center justify-content-between mx-2",children:[e.jsx("p",{children:"Cart Total"}),e.jsxs("p",{children:["₹",E]})]}),e.jsxs("div",{className:"cartTotalContainer d-flex align-items-center justify-content-between mx-2",children:[e.jsx("p",{children:"Shipping Charges"}),e.jsx("p",{children:"₹199"})]}),e.jsxs("div",{className:"totalAmountContainer d-flex align-items-center justify-content-between mx-2",children:[e.jsx("p",{children:"Total Amount"}),e.jsxs("p",{children:["₹",E+199]})]})]})]}),e.jsx(x,{className:"my-3 d-flex justify-content-center align-items-center",children:e.jsx(c,{xs:12,className:"d-flex justify-content-center align-items-center",children:e.jsx("button",{className:"paymentProductButton",onClick:Q,disabled:G,children:G?e.jsx(ce,{animation:"border",size:"sm"}):"Proceed to Payment"})})}),k&&e.jsx(le,{show:k,onHide:()=>q(!1),paymentDetails:O}),L&&e.jsx(oe,{show:L,onHide:()=>F(!1),onTryAgain:Q}),e.jsxs(h,{show:T,onHide:()=>g(!1),children:[e.jsx(h.Header,{closeButton:!0,children:e.jsx(h.Title,{children:"Change Address"})}),e.jsx(h.Body,{children:e.jsxs(a,{children:[e.jsxs(a.Group,{controlId:"formName",children:[e.jsx(a.Label,{children:"Name"}),e.jsx(a.Control,{type:"text",placeholder:"Enter name",value:r.name,onChange:s=>y({...r,name:s.target.value})})]}),e.jsxs(a.Group,{controlId:"formContactNo",children:[e.jsx(a.Label,{children:"Contact Number"}),e.jsx(a.Control,{type:"text",placeholder:"Enter contact number",value:r.contact_no,onChange:s=>y({...r,contact_no:s.target.value})})]}),e.jsxs(a.Group,{controlId:"formEmail",children:[e.jsx(a.Label,{children:"Email"}),e.jsx(a.Control,{type:"email",placeholder:"Enter email",value:r.email,onChange:s=>y({...r,email:s.target.value})})]}),e.jsxs(a.Group,{controlId:"formAddress",children:[e.jsx(a.Label,{children:"Address"}),e.jsx(a.Control,{type:"text",placeholder:"Enter address",value:r.address,onChange:s=>y({...r,address:s.target.value})})]}),e.jsxs(a.Group,{controlId:"formCity",children:[e.jsx(a.Label,{children:"City"}),e.jsx(a.Control,{type:"text",placeholder:"Enter city",value:r.city,onChange:s=>y({...r,city:s.target.value})})]}),e.jsxs(a.Group,{controlId:"formPincode",children:[e.jsx(a.Label,{children:"Pincode"}),e.jsx(a.Control,{type:"text",placeholder:"Enter pincode",value:r.pincode,onChange:s=>y({...r,pincode:s.target.value})})]}),e.jsxs(a.Group,{controlId:"formState",children:[e.jsx(a.Label,{children:"State"}),e.jsx(a.Control,{type:"text",placeholder:"Enter state",value:r.state,onChange:s=>y({...r,state:s.target.value})})]}),e.jsxs(a.Group,{controlId:"formCountry",children:[e.jsx(a.Label,{children:"Country"}),e.jsx(a.Control,{type:"text",value:r.country,disabled:!0})]})]})}),e.jsxs(h.Footer,{children:[e.jsx(M,{variant:"secondary",onClick:()=>g(!1),children:"Close"}),e.jsx(M,{variant:"primary",onClick:K,children:"Save Address"})]})]})]}):e.jsx(I,{fluid:!0,className:"cartContainer",children:e.jsx(x,{className:"d-flex justify-content-center align-items-center my-5",children:e.jsx(c,{className:"d-flex justify-content-center align-items-center",children:e.jsx("p",{className:"npcText",children:"No products in the cart."})})})})]})};export{de as default};
