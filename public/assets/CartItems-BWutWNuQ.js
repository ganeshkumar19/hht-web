import{u as ce,j as e,M as z,R as f,C as y,I as le,w as te,o as Ne,h as Ce,a as F,B as A,r as c,b as ie,c as ne,F as _,S as re,d as be,L as ve,e as V,H as Se,f as we,g as X,i as _e,k as Ae}from"./index-BpqUem9c.js";const ke=({show:r,onHide:l,paymentDetails:i})=>{const{userName:m,userEmail:j,cartItems:o,grandTotal:p,referenceNumber:g}=i,s=ce(),N=(p/100).toFixed(2),C=()=>{l(),s("/")};return e.jsx(z,{show:r,onHide:l,centered:!0,className:"paymentConfirmModal",children:e.jsxs(z.Body,{className:"paymentconfirmbody",children:[e.jsx("h4",{className:"text-center ptcText pb-4",children:"Your order has been confirmed!"}),e.jsx(f,{className:"mb-4",style:{borderBottom:"2px solid #000",padding:"2px 0"},children:e.jsxs(y,{xs:12,children:[e.jsxs("p",{className:"paymentUserInfo",children:[e.jsx("strong",{className:"paymentUserDetails me-2",children:"Name:"})," ",m||"Guest"]}),e.jsxs("p",{className:"paymentUserInfo",children:[e.jsx("strong",{className:"paymentUserDetails me-2",children:"Reference number:"})," ",g]}),e.jsxs("p",{className:"paymentUserInfo",children:[e.jsx("strong",{className:"paymentUserDetails me-2",children:"Email:"})," ",j||"Not provided"]})]})}),o.map((u,$)=>{var b,R;return e.jsx("div",{className:"mb-3",style:{borderBottom:"2px solid #000",padding:"2px 0"},children:e.jsxs(f,{children:[e.jsxs(y,{xs:8,children:[e.jsx("h6",{className:"pcName",children:(b=u==null?void 0:u.product)==null?void 0:b.name}),e.jsxs("p",{className:"pcSizeQty",children:["Size: ",(R=u==null?void 0:u.product_variant)==null?void 0:R.variant_size,"   |   Qty: ",u==null?void 0:u.quantity]})]}),e.jsx(y,{xs:4,className:"text-end",children:e.jsx("h6",{className:"pcPrice",children:u==null?void 0:u.price})})]})},$)}),e.jsxs(f,{className:"my-3",children:[e.jsx(y,{xs:8,children:e.jsx("h5",{className:"paymentamountTotal",children:"Amount Paid"})}),e.jsx(y,{xs:4,className:"text-end",children:e.jsxs("h5",{className:"paymentamountTotal",children:["₹",N]})})]}),e.jsx("div",{className:"my-3 d-flex justify-content-center align-items-center",children:e.jsx("button",{className:"paymentConfirmButton",onClick:C,children:"Return Home"})})]})})},Pe=({show:r,onHide:l,onTryAgain:i})=>e.jsx(z,{show:r,onHide:l,centered:!0,className:"paymentrejectModal",children:e.jsxs(z.Body,{className:"paymentrejectbody",children:[e.jsx("h4",{className:"text-center ptrText pb-4",children:"Payment Unsuccessful"}),e.jsx(f,{children:e.jsx(y,{xs:12,className:"d-flex justify-content-center align-items-center",children:e.jsx("p",{className:"paymentRejectedText text-center",children:"Oops! Your payment didn't go through. Please attempt again."})})}),e.jsxs("div",{className:"my-3 d-flex justify-content-between align-items-center",children:[e.jsx("button",{className:"paymentRejectedButton trButton",onClick:l,children:"Cancel"}),e.jsx("button",{className:"paymentRejectedButton",onClick:i,children:"Try Again"})]})]})}),$e=({show:r,onHide:l,selectedId:i,addresses:m,handleAddressChange:j})=>{const o=ce(),p=s=>{switch(s){case"Home":return Ce;case"Work":return te;case"Others":return Ne;default:return te}},g=()=>{o("/profile/address",{state:{fromModal:!0}})};return e.jsx(z,{show:r,onHide:l,className:"addressChangeModal",children:e.jsxs("div",{className:"addressChangeModalContainer",children:[e.jsx("div",{className:"d-flex justify-content-center align-items-center",children:e.jsx("p",{className:"cdaText text-center",children:"Choose a delivery address"})}),m.map(s=>e.jsxs("div",{className:`d-flex justify-content-start align-items-center py-3 px-2 w-100 choosenCatInfoContainer 
            ${i===s.ID?"selected-address":""}`,onClick:()=>j(s),children:[e.jsx(le,{src:p(s.category),className:"choosenCatIcon",alt:s.category}),e.jsxs("div",{className:"d-flex flex-column mx-2",children:[e.jsx("p",{className:"choosenCatText m-0 p-0",children:s.category}),e.jsx("p",{className:"choosenCatInfo m-0 p-0",children:`${s.line1}, ${s.line2}, ${s.pincode}, ${s.state}, ${s.country}`})]})]},s.ID)),e.jsx(z.Footer,{className:"d-flex justify-content-center align-items-center",children:e.jsx("button",{className:"addnewaddressbutton",onClick:g,children:"+Add New Address"})})]})})},ze=async(r,l,i)=>{try{return await F.put(`https://dhya.one/hht/merchant/cart/${r}`,l,{headers:{Authorization:`Bearer ${i}`}})}catch{throw new Error("Failed to update cart. Please try again.")}},Re=async(r,l)=>{try{return await F.post("https://dhya.one/hht/merchant/order/placeorder",r,{headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"}})}catch{throw new Error("Failed to place order. Please try again.")}},Ee=async(r,l,i,m,j,o,p,g,s,N,C,u,$)=>{try{const b={order_id:l.ID,razorpay_order_id:r.razorpay_order_id,razorpay_payment_id:r.razorpay_payment_id,razorpay_signature:r.razorpay_signature};if((await F.post("https://dhya.one/hht/merchant/payment/paymentsuccess",b,{headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"}})).data.status==="success")A.success("Payment successful!"),u({userName:m==null?void 0:m.display_name,userEmail:j,userPhone:o,cartItems:p,grandTotal:g,referenceNumber:r.razorpay_payment_id}),s(!1),C(!0),N(!1),window.scrollTo(0,0);else throw new Error("Payment success API failed.")}catch(b){console.error("Error in calling payment success API:",b),A.error("Failed to confirm payment. Please try again.")}finally{$(!1)}},Te=async(r,l,i,m,j)=>{try{const o={order_id:r.ID};await F.post("https://dhya.one/hht/merchant/payment/paymentfailed",o,{headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"}}),A.error("Payment failed. Please try again."),i(!0),m(!0),window.scrollTo(0,0)}catch(o){console.error("Error in calling payment failure API:",o),A.error("Failed to handle payment failure.")}finally{j(!1)}},De=async(r,l,i,m,j,o,p,g,s,N,C,u,$,b,R,B,T)=>{const v=String(l.razorpay_order_id),H=String(l.currency||"INR"),x=j.find(h=>h.ID===o);if(!await r()){A.error("Failed to load Razorpay SDK. Please try again later."),T(!1);return}const O={key:i,amount:m,currency:H,name:"HHT Entertainment",description:"Purchase Description",image:"https://hiphoptamizha.com/assets/hhtlogo-C5v3yLtg.png",order_id:v,handler:async h=>{await Ee(h,l,p,s,N,C,g,m,u,$,b,R,T)},prefill:{name:(s==null?void 0:s.display_name)||"NA",email:N||"NA",contact:C||"NA"},notes:{address:`${(x==null?void 0:x.line1)||"NA"}, ${(x==null?void 0:x.line2)||"NA"}, ${x.city||"NA"}, ${x.state||"NA"}, ${x.country||"NA"}`,phone:C||"NA",cart_items:g.map(h=>{var E,d;return`${(E=h==null?void 0:h.product)==null?void 0:E.name}, Size: ${(d=h==null?void 0:h.product_variant)==null?void 0:d.variant_size}, Qty: ${h==null?void 0:h.quantity}`}).join(", ")},theme:{color:"#3399cc"},modal:{ondismiss:async()=>{T(!1),await Te(l,p,u,$,T)}}},M=new window.Razorpay(O);M.on("payment.failed",async h=>{}),M.open()},oe={control:r=>({...r,borderRadius:"0",fontFamily:'"Neuebold", sans-serif',fontSize:"13px",fontWeight:700,color:"#000",backgroundColor:"#DDDBC6",minHeight:"34px"}),menuList:r=>({...r,maxHeight:"80px",overflowY:"auto","::-webkit-scrollbar":{width:"6px"},"::-webkit-scrollbar-thumb":{background:"#888",borderRadius:"10px"},"::-webkit-scrollbar-thumb:hover":{background:"#555"},"::-webkit-scrollbar-track":{background:"#f1f1f1"}}),menu:r=>({...r,zIndex:10})},Ie=({show:r,onHide:l,selectedId:i,addresses:m,handleAddressChange:j,setSelectedAddress:o})=>{const[p,g]=c.useState(!1),[s,N]=c.useState({name:"",contact_no:"",email:"",line1:"",line2:"",landmark:"",city:"",pincode:"",state:"",country:"India",category:"Home"}),[C,u]=c.useState(null),[$,b]=c.useState(null),[R,B]=c.useState([]),{addAddress:T}=ie(),[v,H]=c.useState({}),x=Object.keys(ne).map(t=>({value:t,label:t})),Q=t=>{u(t),N(P=>({...P,state:t.value}));const k=ne[t.value];B(k.map(P=>({value:P,label:P}))),b(null)},O=t=>{b(t),N(k=>({...k,city:t.value}))},M=[{label:"Receiver's Name",type:"text",placeholder:"Enter name",value:s.name,errorKey:"name",field:"name"},{label:"Contact Number",type:"tel",placeholder:"Enter contact number",value:s.contact_no,errorKey:"contact_no",field:"contact_no"},{label:"Email",type:"email",placeholder:"Enter email",value:s.email,errorKey:"email",field:"email"},{label:"House/Flat/Block No",type:"text",placeholder:"Enter address line 1",value:s.line1,errorKey:"line1",field:"line1"},{label:"Apartment/Road/Area",type:"text",placeholder:"Enter address line 2",value:s.line2,errorKey:"line2",field:"line2"},{label:"Landmark (Optional)",type:"text",placeholder:"Enter landmark",value:s.landmark,field:"landmark"},{label:"Country",type:"text",value:"India",field:"country",disabled:!0}],h=(t,k)=>{N(P=>({...P,[t]:k}))},E=t=>/^[6-9]\d{9}$/.test(t),d=t=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t),q=()=>{let t={};return s.name||(t.name="Receiver's Name is required"),s.contact_no?E(s.contact_no)||(t.contact_no="Enter a valid 10-digit mobile number"):t.contact_no="Contact Number is required",s.email?d(s.email)||(t.email="Enter a valid email address"):t.email="Email is required",s.line1||(t.line1="House/Flat/Block No is required"),s.line2||(t.line2="Apartment/Road/Area is required"),s.state||(t.state="State is required"),s.city||(t.city="City is required"),s.pincode||(t.pincode="Pincode is required"),H(t),Object.keys(t).length===0},L=async()=>{if(q()){g(!0);try{await T(s)?(o(s),j(s),A.success("Address added successfully!"),l()):A.error("Failed to add address. Please try again.")}catch(t){console.error("Error adding address:",t),A.error("An error occurred while adding the address.")}finally{g(!1)}}};return e.jsxs(z,{show:r,onHide:l,className:"guestAddressModal",centered:!0,children:[e.jsx(z.Header,{closeButton:!0,children:e.jsx(z.Title,{className:"anaText",children:"Add New Address"})}),e.jsx(z.Body,{children:e.jsxs(_,{className:"guestmodalForm",children:[M.map(({label:t,type:k,placeholder:P,value:K,errorKey:Y,field:G,disabled:W})=>e.jsxs(_.Group,{as:f,controlId:`form-${G}`,className:"mb-3",children:[e.jsx(_.Label,{column:!0,sm:"4",className:"guestlabel",children:t}),e.jsxs(y,{sm:"8",children:[e.jsx(_.Control,{type:k,placeholder:P,value:K,onChange:I=>h(G,I.target.value),isInvalid:!!v[Y],disabled:W,className:"guestAddressInput",style:{backgroundColor:"#DDDBC6"}}),v[Y]&&e.jsx(_.Control.Feedback,{type:"invalid",children:v[Y]})]})]},G)),e.jsxs(_.Group,{as:f,controlId:"formState",className:"mb-3",children:[e.jsx(_.Label,{column:!0,sm:"4",className:"guestlabel",children:"State"}),e.jsxs(y,{sm:"8",children:[e.jsx(re,{options:x,value:C,onChange:Q,styles:oe,placeholder:"Select State"}),v.state&&e.jsx("div",{className:"error-text",children:v.state})]})]}),e.jsxs(_.Group,{as:f,controlId:"formCity",className:"mb-3",children:[e.jsx(_.Label,{column:!0,sm:"4",className:"guestlabel",children:"City"}),e.jsxs(y,{sm:"8",children:[e.jsx(re,{options:R,value:$,onChange:O,placeholder:"Select City",styles:oe,isDisabled:!C}),v.city&&e.jsx("div",{className:"error-text",children:v.city})]})]}),e.jsxs(_.Group,{as:f,controlId:"formPincode",className:"mb-3",children:[e.jsx(_.Label,{column:!0,sm:"4",className:"guestlabel",children:"Pincode"}),e.jsxs(y,{sm:"8",children:[e.jsx(_.Control,{type:"text",placeholder:"Enter pincode",className:"guestAddressInput",value:s.pincode,onChange:t=>N({...s,pincode:t.target.value}),isInvalid:!!v.pincode}),e.jsx(_.Control.Feedback,{type:"invalid",children:v.pincode})]})]})]})}),e.jsx(z.Footer,{className:"d-flex justify-content-center align-items-center",children:e.jsx("button",{className:"guestnewaddressButton",onClick:L,disabled:p,children:p?"Saving...":"Add Address"})})]})},Be=()=>{const{cart:r=[],removeFromCart:l,setCart:i,cartId:m,setCartId:j}=c.useContext(be),{userDetails:o}=ie(),p=(o==null?void 0:o.addresses)||[],[g,s]=c.useState(!1),[N,C]=c.useState(null),[u,$]=c.useState(null),[b,R]=c.useState(null),[B,T]=c.useState(!1),[v,H]=c.useState({}),[x,Q]=c.useState(!1),[O,M]=c.useState(!1),[h,E]=c.useState(!1),[d,q]=c.useState(null),[L,t]=c.useState(null),[k,P]=c.useState(!1),[K,Y]=c.useState(localStorage.getItem("access_token")),[G,W]=c.useState(!1);c.useEffect(()=>{(o==null?void 0:o.status)==="guest"?W(!0):W(!1)},[o]),c.useEffect(()=>{if(!m)return;(async()=>{s(!0);try{const n=await F.get(`https://dhya.one/hht/merchant/cart/${m}`,{headers:{Authorization:`Bearer ${K}`}});i(n.data.data.items),console.log("rsp",n.data.data.items)}catch(n){console.error("Error fetching cart data:",n),i([])}finally{s(!1)}})()},[m,K]);const I=c.useMemo(()=>r.reduce((a,n)=>a+n.price*n.quantity,0),[r]);c.useEffect(()=>{if(p.length>0){const a=p.find(n=>n.is_primary);a?(q(a),t(a.ID)):(q(p[0]),t(p[0].ID))}else q(null),t(null)},[p]);const de=()=>{E(!0),console.log(E)},Z=a=>{console.log("Selected address:",a),q(a),t(a.ID),E(!1)},me=c.useMemo(()=>{var a,n;return((n=(a=o==null?void 0:o.contacts)==null?void 0:a.find(S=>S.contact_type==="email"))==null?void 0:n.contact)||(d==null?void 0:d.email)||""},[o,d==null?void 0:d.email]),ue=c.useMemo(()=>{var a,n;return((n=(a=o==null?void 0:o.contacts)==null?void 0:a.find(S=>S.contact_type==="phone"))==null?void 0:n.contact)||(d==null?void 0:d.contact_no)||""},[o,d==null?void 0:d.contact_no]),he=()=>new Promise(a=>{const n=document.createElement("script");n.src="https://checkout.razorpay.com/v1/checkout.js",n.onload=()=>{a(!0)},n.onerror=()=>{a(!1)},document.body.appendChild(n)}),pe=async a=>{R(a);try{const n=localStorage.getItem("access_token");await F.delete(`https://dhya.one/hht/merchant/cartItem/${a}`,{headers:{Authorization:`Bearer ${n}`}}),l(a)}catch(n){console.error("Error removing item from cart:",n),alert("Failed to remove the item. Please try again.")}finally{R(null)}},ee=async()=>{var a,n,S,w;if(!d){A.error("Please select an address before proceeding.");return}try{P(!0);const D=localStorage.getItem("access_token"),U=I+(I>0?199:0),ae=await ze(m,{id:m,total_price:U},D);if(ae.data.status==="success"){const fe={cart_id:ae.data.data.ID,billing_address_id:L,shipping_address_id:L,shipping_rate:199},se=await Re(fe,D),je=(n=(a=se.data)==null?void 0:a.data)==null?void 0:n.order,ge=(w=(S=se.data)==null?void 0:S.data)==null?void 0:w.razor_key;await De(he,je,ge,U*100,p,L,D,r,o,me,ue,Q,M,T,H,i,P)}}catch(D){console.error("Error in payment flow:",D),A.error(D.message),P(!1)}},ye=async a=>{if(a.quantity>=10){A.error("Quantity should not exceed beyond 10.");return}if(a.quantity<a.product_variant.quantity&&a.quantity<10){C(a.ID);try{const n=a.quantity+1,S=localStorage.getItem("access_token");await F.put(`https://dhya.one/hht/merchant/cartItem/${a.ID}`,{ID:a.ID,quantity:n},{headers:{Authorization:`Bearer ${S}`}}),i(r.map(w=>w.ID===a.ID?{...w,quantity:n}:w))}catch(n){console.error("Error updating quantity:",n),alert("Failed to update the quantity. Please try again.")}finally{C(null)}}else A.error(`Cannot add more than ${a.product_variant.quantity} items.`)},xe=async a=>{if(a.quantity>1){$(a.ID);try{const n=a.quantity-1,S=localStorage.getItem("access_token");await F.put(`https://dhya.one/hht/merchant/cartItem/${a.ID}`,{ID:a.ID,quantity:n},{headers:{Authorization:`Bearer ${S}`}}),i(r.map(w=>w.ID===a.ID?{...w,quantity:n}:w))}catch(n){console.error("Error updating quantity:",n),alert("Failed to update the quantity. Please try again.")}finally{$(null)}}else A.error("Quantity cannot be less than 1.")};return g?e.jsx(ve,{}):r.length===0?e.jsx(V,{fluid:!0,className:"cartContainer",children:e.jsx(f,{className:"d-flex justify-content-center align-items-center my-5",children:e.jsx(y,{className:"d-flex justify-content-center align-items-center",children:e.jsx("p",{className:"npcText",children:"No products in the cart."})})})}):e.jsxs(V,{fluid:!0,className:"cartContainer",children:[e.jsx(Se,{backgroundColor:"#3EA66B",color:"#F4E003",name:"Cart"}),r.length>0?e.jsxs(V,{children:[e.jsx(f,{className:"mt-3 d-flex justify-content-center justify-content-sm-end align-items-center",children:e.jsxs(y,{xs:12,className:"addressColumn d-flex justify-content-between align-items-center my-3",children:[e.jsxs("div",{className:"deliverContainer p-0 m-0 w-100",children:[console.log(d),e.jsxs("p",{className:"p-0 m-0 deliverText",children:["Deliver to:  ",d?`${d.category}, ${d.pincode}`:"No address selected"]})]}),e.jsx("div",{className:"changeAddressContainer",children:e.jsx("p",{className:"changeAddressText",onClick:de,children:d?"Change":"Add"})})]})}),r.map(a=>{var n,S,w,D,U,J;return e.jsx(we.Fragment,{children:e.jsx(f,{className:"my-3 d-flex justify-content-center align-items-center",children:e.jsx(y,{xs:12,className:"cartImageRow",children:e.jsxs(f,{children:[e.jsx(y,{xs:4,lg:3,className:"cartImageColumn",children:e.jsx("div",{className:"cartImageContainer",children:((S=(n=a==null?void 0:a.product)==null?void 0:n.images)==null?void 0:S.length)>0?e.jsx(le,{fluid:!0,src:a.product.images[0].image_url,alt:"product-image",className:"crtImage"}):null})}),e.jsxs(y,{xs:6,lg:7,className:"cartDetails m-0 p-0",children:[e.jsx("p",{className:"cartprName p-0 m-0",children:(w=a==null?void 0:a.product)==null?void 0:w.name}),e.jsxs("div",{className:"d-flex justify-content-start align-items-center w-100 my-1",children:[e.jsx("div",{className:"ssSizeContainer d-flex align-items-center",children:e.jsxs("p",{className:"m-0 p-0",children:["Size: ",(D=a==null?void 0:a.product_variant)==null?void 0:D.variant_size]})}),e.jsxs("div",{className:"ssSizeContainer d-flex align-items-center",children:[e.jsx("p",{className:"m-0 p-0",children:"Qty"}),e.jsxs("div",{className:"d-flex align-items-center justify-content-between ms-2",children:[e.jsx("p",{className:"m-0 px-1 actionicon",onClick:()=>xe(a),children:u===a.ID?e.jsx(X,{className:"loadingSpinner"}):"-"}),e.jsx("p",{className:"m-0 px-1",children:a.quantity}),e.jsx("p",{className:"m-0 px-1 actionicon",onClick:()=>ye(a),children:N===a.ID?e.jsx(X,{className:"loadingSpinner"}):"+"})]})]})]}),e.jsxs("p",{className:"cartprprice p-0 m-0 mt-1 mt-md-3 d-flex justify-content-start align-items-center",children:[e.jsxs("span",{className:"carogprice me-3",children:["₹",(U=a==null?void 0:a.product)==null?void 0:U.base_price]})," ₹",a==null?void 0:a.price]})," ",e.jsx("p",{className:"cartmrptext",children:"MRP incl. of all taxes"}),e.jsxs("p",{className:"cartmrproff",children:[(J=a==null?void 0:a.product)==null?void 0:J.discount,"% off"]})," "]}),e.jsx(y,{xs:2,lg:2,className:"cartDetailsIcon d-flex align-items-start justify-content-end",children:b===a.ID?e.jsx(X,{className:"loadingSpinner"}):e.jsx(_e,{className:"closeIcon",onClick:()=>pe(a.ID)})})]})})})},a.ID)}),e.jsxs(f,{className:"my-4 d-flex justify-content-center align-items-center",children:[e.jsx(y,{xs:12,className:"cartPriceRow",children:e.jsx("h4",{className:"pricedetailtext",children:"Price Details"})}),e.jsxs(y,{xs:12,className:"cartPriceRow",children:[e.jsxs("div",{className:"cartTotalContainer d-flex align-items-center justify-content-between mx-2",children:[e.jsx("p",{children:"Cart Total"}),e.jsxs("p",{children:["₹",I]})]}),e.jsxs("div",{className:"cartTotalContainer d-flex align-items-center justify-content-between mx-2",children:[e.jsx("p",{children:"Shipping Charges"}),e.jsxs("p",{children:["₹",I>0?199:0]})]}),e.jsxs("div",{className:"totalAmountContainer d-flex align-items-center justify-content-between mx-2",children:[e.jsx("p",{children:"Total Amount"}),e.jsxs("p",{children:["₹",I+(I>0?199:0)]})]})]})]}),e.jsx(f,{className:"my-3 d-flex justify-content-center align-items-center",children:e.jsx(y,{xs:12,className:"d-flex justify-content-center align-items-center",children:e.jsx("button",{className:"paymentProductButton",onClick:ee,disabled:k,children:k?e.jsx(Ae,{animation:"border",size:"sm"}):"Payment"})})}),B&&e.jsx(ke,{show:B,onHide:()=>{T(!1),i([]),j(null)},paymentDetails:v}),x&&!B&&e.jsx(Pe,{show:x,onHide:()=>{Q(!1)},onTryAgain:ee}),h&&(G?e.jsx(Ie,{show:h,onHide:()=>E(!1),handleAddressChange:Z,setSelectedAddress:q}):e.jsx($e,{show:h,onHide:()=>E(!1),selectedId:L,addresses:p,handleAddressChange:Z}))]}):null]})};export{Be as default};
