import{u as oe,j as e,M as S,R as g,C as h,a as P,B as u,r as p,b as le,c as U,H as ie,F as Q,d as de,I as me,e as he,S as pe,f as n,g as W}from"./index-C2LjgBWB.js";const ue=({show:i,onHide:t,paymentDetails:c})=>{const{userName:r,userEmail:j,cartItems:d,grandTotal:b,referenceNumber:A}=c,y=oe(),_=(b/100).toFixed(2),N=()=>{t(),y("/")};return e.jsx(S,{show:i,onHide:t,centered:!0,className:"paymentConfirmModal",children:e.jsxs(S.Body,{className:"paymentconfirmbody",children:[e.jsx("h4",{className:"text-center ptcText pb-4",children:"Your order has been confirmed!"}),e.jsx(g,{className:"mb-4",style:{borderBottom:"2px solid #000",padding:"2px 0"},children:e.jsxs(h,{xs:12,children:[e.jsxs("p",{className:"paymentUserInfo",children:[e.jsx("strong",{className:"paymentUserDetails me-2",children:"Name:"})," ",r||"Guest"]}),e.jsxs("p",{className:"paymentUserInfo",children:[e.jsx("strong",{className:"paymentUserDetails me-2",children:"Reference number:"})," ",A]}),e.jsxs("p",{className:"paymentUserInfo",children:[e.jsx("strong",{className:"paymentUserDetails me-2",children:"Email:"})," ",j||"Not provided"]})]})}),d.map((o,v)=>{var C,z;return e.jsx("div",{className:"mb-3",style:{borderBottom:"2px solid #000",padding:"2px 0"},children:e.jsxs(g,{children:[e.jsxs(h,{xs:8,children:[e.jsx("h6",{className:"pcName",children:(C=o==null?void 0:o.product)==null?void 0:C.name}),e.jsxs("p",{className:"pcSizeQty",children:["Size: ",(z=o==null?void 0:o.product_variant)==null?void 0:z.variant_size,"   |   Qty: ",o==null?void 0:o.quantity]})]}),e.jsx(h,{xs:4,className:"text-end",children:e.jsx("h6",{className:"pcPrice",children:o==null?void 0:o.price})})]})},v)}),e.jsxs(g,{className:"my-3",children:[e.jsx(h,{xs:8,children:e.jsx("h5",{className:"paymentamountTotal",children:"Amount Paid"})}),e.jsx(h,{xs:4,className:"text-end",children:e.jsxs("h5",{className:"paymentamountTotal",children:["₹",_]})})]}),e.jsx("div",{className:"my-3 d-flex justify-content-center align-items-center",children:e.jsx("button",{className:"paymentConfirmButton",onClick:N,children:"Return Home"})})]})})},ye=({show:i,onHide:t,onTryAgain:c})=>e.jsx(S,{show:i,onHide:t,centered:!0,className:"paymentrejectModal",children:e.jsxs(S.Body,{className:"paymentrejectbody",children:[e.jsx("h4",{className:"text-center ptrText pb-4",children:"Payment Unsuccessful"}),e.jsx(g,{children:e.jsx(h,{xs:12,className:"d-flex justify-content-center align-items-center",children:e.jsx("p",{className:"paymentRejectedText text-center",children:"Oops! Your payment didn't go through. Please attempt again."})})}),e.jsxs("div",{className:"my-3 d-flex justify-content-between align-items-center",children:[e.jsx("button",{className:"paymentRejectedButton trButton",onClick:t,children:"Cancel"}),e.jsx("button",{className:"paymentRejectedButton",onClick:c,children:"Try Again"})]})]})}),xe=async(i,t,c)=>{try{return await P.put(`https://dhya.one/hht/merchant/cart/${i}`,t,{headers:{Authorization:`Bearer ${c}`}})}catch{throw new Error("Failed to update cart. Please try again.")}},je=async(i,t)=>{try{return await P.post("https://dhya.one/hht/merchant/order/placeorder",i,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}})}catch{throw new Error("Failed to place order. Please try again.")}},fe=async(i,t,c,r,j,d,b,A,y,_,N,o,v)=>{try{const C={order_id:t.ID,razorpay_order_id:i.razorpay_order_id,razorpay_payment_id:i.razorpay_payment_id,razorpay_signature:i.razorpay_signature};if((await P.post("https://dhya.one/hht/merchant/payment/paymentsuccess",C,{headers:{Authorization:`Bearer ${c}`,"Content-Type":"application/json"}})).data.status==="success")u.success("Payment successful!"),o({userName:r==null?void 0:r.display_name,userEmail:j,userPhone:d,cartItems:b,grandTotal:A,referenceNumber:i.razorpay_payment_id}),y(!1),N(!0),_(!1),window.scrollTo(0,0);else throw new Error("Payment success API failed.")}catch(C){console.error("Error in calling payment success API:",C),u.error("Failed to confirm payment. Please try again.")}finally{v(!1)}},ge=async(i,t,c,r,j)=>{try{const d={order_id:i.ID};await P.post("https://dhya.one/hht/merchant/payment/paymentfailed",d,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}}),u.error("Payment failed. Please try again."),c(!0),r(!0),window.scrollTo(0,0)}catch(d){console.error("Error in calling payment failure API:",d),u.error("Failed to handle payment failure.")}finally{j(!1)}},Ne=async(i,t,c,r,j,d,b,A,y,_,N,o,v,C,z,O,$)=>{const T=String(t.razorpay_order_id),B=String(t.currency||"INR"),f=j.find(m=>m.ID===d);if(!await i()){u.error("Failed to load Razorpay SDK. Please try again later."),$(!1);return}const E={key:c,amount:r,currency:B,name:"HHT Entertainment",description:"Purchase Description",image:"https://hiphoptamizha.com/assets/hhtlogo-C5v3yLtg.png",order_id:T,handler:async m=>{await fe(m,t,b,y,_,N,A,r,o,v,C,z,$)},prefill:{name:(y==null?void 0:y.display_name)||"NA",email:_||"NA",contact:N||"NA"},notes:{address:`${(f==null?void 0:f.line1)||"NA"}, ${(f==null?void 0:f.line2)||"NA"}, ${f.city||"NA"}, ${f.state||"NA"}, ${f.country||"NA"}`,phone:N||"NA",cart_items:A.map(m=>{var k,I;return`${(k=m==null?void 0:m.product)==null?void 0:k.name}, Size: ${(I=m==null?void 0:m.product_variant)==null?void 0:I.variant_size}, Qty: ${m==null?void 0:m.quantity}`}).join(", ")},theme:{color:"#3399cc"},modal:{ondismiss:async()=>{$(!1),await ge(t,b,o,v,$)}}},F=new window.Razorpay(E);F.on("payment.failed",async m=>{}),F.open()},Se=()=>{const{removeFromCart:i,setCart:t,cartId:c}=p.useContext(le),[r,j]=p.useState([]),[d,b]=p.useState(null),[A,y]=p.useState(!1),[_,N]=p.useState(!0),[o,v]=p.useState(null),[C,z]=p.useState(null),[O,$]=p.useState(null),[T,B]=p.useState(!1),[f,H]=p.useState(!1),[E,F]=p.useState(null),[m,k]=p.useState({userName:"",userEmail:"",cartItems:[],grandTotal:0,referenceNumber:""}),[I,M]=p.useState(!1),[l,R]=p.useState({name:"",contact_no:"",email:"",address:"",landmark:"",city:"",pincode:"",state:"",country:"India",category:"Home"}),q=localStorage.getItem("access_token"),L="https://dhya.one/hht",X=async()=>{try{const a=await P.get(`${L}/merchant/cart/${c}`,{headers:{Authorization:`Bearer ${q}`}});j(a.data.data.items),N(!1)}catch(a){console.error("Error fetching cart data:",a),u.error("Failed to fetch cart items."),N(!1)}},Z=()=>{localStorage.setItem("address",JSON.stringify(l)),b(l),F(l.ID),y(!1),u.success("Address saved successfully!")},ee=async a=>{if(a.quantity>=10){u.error("Quantity should not exceed beyond 10.");return}v(a.ID);try{const s=a.quantity+1;await P.put(`${L}/merchant/cartItem/${a.ID}`,{ID:a.ID,quantity:s},{headers:{Authorization:`Bearer ${q}`}}),j(r.map(x=>x.ID===a.ID?{...x,quantity:s}:x))}catch(s){console.error("Error increasing quantity:",s),u.error("Failed to increase quantity.")}finally{v(null)}},ae=async a=>{if(a.quantity<=1){u.error("Quantity cannot be less than 1.");return}z(a.ID);try{const s=a.quantity-1;await P.put(`${L}/merchant/cartItem/${a.ID}`,{ID:a.ID,quantity:s},{headers:{Authorization:`Bearer ${q}`}}),j(r.map(x=>x.ID===a.ID?{...x,quantity:s}:x))}catch(s){console.error("Error decreasing quantity:",s),u.error("Failed to decrease quantity.")}finally{z(null)}},se=async a=>{$(a);try{await P.delete(`${L}/merchant/cartItem/${a}`,{headers:{Authorization:`Bearer ${q}`}}),j(r.filter(s=>s.ID!==a))}catch(s){console.error("Error removing item from cart:",s),u.error("Failed to remove item.")}finally{$(null)}},G=r.reduce((a,s)=>a+s.price*s.quantity,0);p.useEffect(()=>{c&&X()},[c]);const ne=()=>new Promise(a=>{const s=document.createElement("script");s.src="https://checkout.razorpay.com/v1/checkout.js",s.onload=()=>{a(!0)},s.onerror=()=>{a(!1)},document.body.appendChild(s)}),Y=async()=>{var a,s,x,D;if(!d){u.error("Please select an address before proceeding.");return}try{M(!0);const w=localStorage.getItem("access_token"),J=G+(G>0?199:0),K=await xe(c,{id:c,total_price:J},w);if(K.data.status==="success"){const te={cart_id:K.data.data.ID,billing_address_id:E,shipping_address_id:E,shipping_rate:199},V=await je(te,w),re=(s=(a=V.data)==null?void 0:a.data)==null?void 0:s.order,ce=(D=(x=V.data)==null?void 0:x.data)==null?void 0:D.razor_key;await Ne(ne,re,ce,J*100,addresses,E,w,r,userDetails,emailContact,phoneContact,H,setPaymentAttempted,B,k,t,M)}}catch(w){console.error("Error in payment flow:",w),u.error(w.message),M(!1)}};return e.jsxs(U,{fluid:!0,className:"cartContainer",children:[e.jsx(ie,{backgroundColor:"#3EA66B",color:"#F4E003",name:"Cart"}),_?e.jsx(g,{className:"d-flex justify-content-center align-items-center my-5",children:e.jsx(h,{className:"d-flex justify-content-center align-items-center",children:e.jsx(Q,{className:"loadingSpinner"})})}):r.length>0?e.jsxs(U,{children:[e.jsx(g,{className:"mt-3 d-flex justify-content-center justify-content-sm-end align-items-center",children:e.jsxs(h,{xs:12,className:"addressColumn d-flex justify-content-between align-items-center my-3",children:[e.jsx("div",{className:"deliverContainer p-0 m-0 w-100",children:e.jsxs("p",{className:"p-0 m-0 deliverText",children:["Deliver to: ",d?`${d.name}, ${d.address}, ${d.city}, ${d.pincode}`:"No address selected"]})}),e.jsx("div",{className:"changeAddressContainer",children:e.jsx("p",{className:"changeAddressText",onClick:()=>y(!0),children:d?"Change Address":"Add Address"})})]})}),r.map(a=>{var s,x,D,w;return e.jsx(de.Fragment,{children:e.jsx(g,{className:"my-3 d-flex justify-content-center align-items-center",children:e.jsx(h,{xs:12,className:"cartImageRow",children:e.jsxs(g,{children:[e.jsx(h,{xs:4,lg:3,className:"cartImageColumn",children:e.jsx("div",{className:"cartImageContainer",children:((x=(s=a==null?void 0:a.product)==null?void 0:s.images)==null?void 0:x.length)>0?e.jsx(me,{fluid:!0,src:a.product.images[0].image_url,alt:"product-image",className:"crtImage"}):null})}),e.jsxs(h,{xs:6,lg:7,className:"cartDetails m-0 p-0",children:[e.jsx("p",{className:"cartprName p-0 m-0",children:(D=a==null?void 0:a.product)==null?void 0:D.name}),e.jsxs("div",{className:"d-flex justify-content-start align-items-center w-100 my-1",children:[e.jsx("div",{className:"ssSizeContainer d-flex align-items-center",children:e.jsxs("p",{className:"m-0 p-0",children:["Size: ",(w=a==null?void 0:a.product_variant)==null?void 0:w.variant_size]})}),e.jsxs("div",{className:"ssSizeContainer d-flex align-items-center",children:[e.jsx("p",{className:"m-0 p-0",children:"Qty"}),e.jsxs("div",{className:"d-flex align-items-center justify-content-between ms-2",children:[e.jsx("p",{className:"m-0 px-1 actionicon",onClick:()=>ae(a),children:C===a.ID?e.jsx(Q,{className:"loadingSpinner"}):"-"}),e.jsx("p",{className:"m-0 px-1",children:a.quantity}),e.jsx("p",{className:"m-0 px-1 actionicon",onClick:()=>ee(a),children:o===a.ID?e.jsx(Q,{className:"loadingSpinner"}):"+"})]})]})]}),e.jsxs("p",{className:"cartprprice p-0 m-0 mt-1 mt-md-3 d-flex justify-content-start align-items-center",children:["₹",a==null?void 0:a.price]})]}),e.jsx(h,{xs:2,lg:2,className:"cartDetailsIcon d-flex align-items-start justify-content-end",children:O===a.ID?e.jsx(Q,{className:"loadingSpinner"}):e.jsx(he,{className:"closeIcon",onClick:()=>se(a.ID)})})]})})})},a.ID)}),e.jsxs(g,{className:"my-4 d-flex justify-content-center align-items-center",children:[e.jsx(h,{xs:12,className:"cartPriceRow",children:e.jsx("h4",{className:"pricedetailtext",children:"Price Details"})}),e.jsxs(h,{xs:12,className:"cartPriceRow",children:[e.jsxs("div",{className:"cartTotalContainer d-flex align-items-center justify-content-between mx-2",children:[e.jsx("p",{children:"Cart Total"}),e.jsxs("p",{children:["₹",G]})]}),e.jsxs("div",{className:"cartTotalContainer d-flex align-items-center justify-content-between mx-2",children:[e.jsx("p",{children:"Shipping Charges"}),e.jsx("p",{children:"₹199"})]}),e.jsxs("div",{className:"totalAmountContainer d-flex align-items-center justify-content-between mx-2",children:[e.jsx("p",{children:"Total Amount"}),e.jsxs("p",{children:["₹",G+199]})]})]})]}),e.jsx(g,{className:"my-3 d-flex justify-content-center align-items-center",children:e.jsx(h,{xs:12,className:"d-flex justify-content-center align-items-center",children:e.jsx("button",{className:"paymentProductButton",onClick:Y,disabled:I,children:I?e.jsx(pe,{animation:"border",size:"sm"}):"Proceed to Payment"})})}),T&&e.jsx(ue,{show:T,onHide:()=>B(!1),paymentDetails:m}),f&&e.jsx(ye,{show:f,onHide:()=>H(!1),onTryAgain:Y}),e.jsxs(S,{show:A,onHide:()=>y(!1),children:[e.jsx(S.Header,{closeButton:!0,children:e.jsx(S.Title,{children:"Change Address"})}),e.jsx(S.Body,{children:e.jsxs(n,{children:[e.jsxs(n.Group,{controlId:"formName",children:[e.jsx(n.Label,{children:"Name"}),e.jsx(n.Control,{type:"text",placeholder:"Enter name",value:l.name,onChange:a=>R({...l,name:a.target.value})})]}),e.jsxs(n.Group,{controlId:"formContactNo",children:[e.jsx(n.Label,{children:"Contact Number"}),e.jsx(n.Control,{type:"text",placeholder:"Enter contact number",value:l.contact_no,onChange:a=>R({...l,contact_no:a.target.value})})]}),e.jsxs(n.Group,{controlId:"formEmail",children:[e.jsx(n.Label,{children:"Email"}),e.jsx(n.Control,{type:"email",placeholder:"Enter email",value:l.email,onChange:a=>R({...l,email:a.target.value})})]}),e.jsxs(n.Group,{controlId:"formAddress",children:[e.jsx(n.Label,{children:"Address"}),e.jsx(n.Control,{type:"text",placeholder:"Enter address",value:l.address,onChange:a=>R({...l,address:a.target.value})})]}),e.jsxs(n.Group,{controlId:"formCity",children:[e.jsx(n.Label,{children:"City"}),e.jsx(n.Control,{type:"text",placeholder:"Enter city",value:l.city,onChange:a=>R({...l,city:a.target.value})})]}),e.jsxs(n.Group,{controlId:"formPincode",children:[e.jsx(n.Label,{children:"Pincode"}),e.jsx(n.Control,{type:"text",placeholder:"Enter pincode",value:l.pincode,onChange:a=>R({...l,pincode:a.target.value})})]}),e.jsxs(n.Group,{controlId:"formState",children:[e.jsx(n.Label,{children:"State"}),e.jsx(n.Control,{type:"text",placeholder:"Enter state",value:l.state,onChange:a=>R({...l,state:a.target.value})})]}),e.jsxs(n.Group,{controlId:"formCountry",children:[e.jsx(n.Label,{children:"Country"}),e.jsx(n.Control,{type:"text",value:l.country,disabled:!0})]})]})}),e.jsxs(S.Footer,{children:[e.jsx(W,{variant:"secondary",onClick:()=>y(!1),children:"Close"}),e.jsx(W,{variant:"primary",onClick:Z,children:"Save Address"})]})]})]}):e.jsx(U,{fluid:!0,className:"cartContainer",children:e.jsx(g,{className:"d-flex justify-content-center align-items-center my-5",children:e.jsx(h,{className:"d-flex justify-content-center align-items-center",children:e.jsx("p",{className:"npcText",children:"No products in the cart."})})})})]})};export{Se as default};
