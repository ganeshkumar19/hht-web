import{u as de,j as e,M as A,R as v,C as p,a as P,B as y,r as m,b as me,c as he,d as M,H as pe,F as G,e as ue,I as ye,f as xe,S as je,g as n,h as Z}from"./index-BMEZBceP.js";const fe=({show:h,onHide:t,paymentDetails:c})=>{const{userName:r,userEmail:g,cartItems:l,grandTotal:x,referenceNumber:u}=c,j=de(),_=(x/100).toFixed(2),N=()=>{t(),j("/")};return e.jsx(A,{show:h,onHide:t,centered:!0,className:"paymentConfirmModal",children:e.jsxs(A.Body,{className:"paymentconfirmbody",children:[e.jsx("h4",{className:"text-center ptcText pb-4",children:"Your order has been confirmed!"}),e.jsx(v,{className:"mb-4",style:{borderBottom:"2px solid #000",padding:"2px 0"},children:e.jsxs(p,{xs:12,children:[e.jsxs("p",{className:"paymentUserInfo",children:[e.jsx("strong",{className:"paymentUserDetails me-2",children:"Name:"})," ",r||"Guest"]}),e.jsxs("p",{className:"paymentUserInfo",children:[e.jsx("strong",{className:"paymentUserDetails me-2",children:"Reference number:"})," ",u]}),e.jsxs("p",{className:"paymentUserInfo",children:[e.jsx("strong",{className:"paymentUserDetails me-2",children:"Email:"})," ",g||"Not provided"]})]})}),l.map((o,S)=>{var w,z;return e.jsx("div",{className:"mb-3",style:{borderBottom:"2px solid #000",padding:"2px 0"},children:e.jsxs(v,{children:[e.jsxs(p,{xs:8,children:[e.jsx("h6",{className:"pcName",children:(w=o==null?void 0:o.product)==null?void 0:w.name}),e.jsxs("p",{className:"pcSizeQty",children:["Size: ",(z=o==null?void 0:o.product_variant)==null?void 0:z.variant_size,"   |   Qty: ",o==null?void 0:o.quantity]})]}),e.jsx(p,{xs:4,className:"text-end",children:e.jsx("h6",{className:"pcPrice",children:o==null?void 0:o.price})})]})},S)}),e.jsxs(v,{className:"my-3",children:[e.jsx(p,{xs:8,children:e.jsx("h5",{className:"paymentamountTotal",children:"Amount Paid"})}),e.jsx(p,{xs:4,className:"text-end",children:e.jsxs("h5",{className:"paymentamountTotal",children:["₹",_]})})]}),e.jsx("div",{className:"my-3 d-flex justify-content-center align-items-center",children:e.jsx("button",{className:"paymentConfirmButton",onClick:N,children:"Return Home"})})]})})},ge=({show:h,onHide:t,onTryAgain:c})=>e.jsx(A,{show:h,onHide:t,centered:!0,className:"paymentrejectModal",children:e.jsxs(A.Body,{className:"paymentrejectbody",children:[e.jsx("h4",{className:"text-center ptrText pb-4",children:"Payment Unsuccessful"}),e.jsx(v,{children:e.jsx(p,{xs:12,className:"d-flex justify-content-center align-items-center",children:e.jsx("p",{className:"paymentRejectedText text-center",children:"Oops! Your payment didn't go through. Please attempt again."})})}),e.jsxs("div",{className:"my-3 d-flex justify-content-between align-items-center",children:[e.jsx("button",{className:"paymentRejectedButton trButton",onClick:t,children:"Cancel"}),e.jsx("button",{className:"paymentRejectedButton",onClick:c,children:"Try Again"})]})]})}),Ne=async(h,t,c)=>{try{return await P.put(`https://dhya.one/hht/merchant/cart/${h}`,t,{headers:{Authorization:`Bearer ${c}`}})}catch{throw new Error("Failed to update cart. Please try again.")}},Ce=async(h,t)=>{try{return await P.post("https://dhya.one/hht/merchant/order/placeorder",h,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}})}catch{throw new Error("Failed to place order. Please try again.")}},ve=async(h,t,c,r,g,l,x,u,j,_,N,o,S)=>{try{const w={order_id:t.ID,razorpay_order_id:h.razorpay_order_id,razorpay_payment_id:h.razorpay_payment_id,razorpay_signature:h.razorpay_signature};if((await P.post("https://dhya.one/hht/merchant/payment/paymentsuccess",w,{headers:{Authorization:`Bearer ${c}`,"Content-Type":"application/json"}})).data.status==="success")y.success("Payment successful!"),o({userName:r==null?void 0:r.display_name,userEmail:g,userPhone:l,cartItems:x,grandTotal:u,referenceNumber:h.razorpay_payment_id}),j(!1),N(!0),_(!1),window.scrollTo(0,0);else throw new Error("Payment success API failed.")}catch(w){console.error("Error in calling payment success API:",w),y.error("Failed to confirm payment. Please try again.")}finally{S(!1)}},we=async(h,t,c,r,g)=>{try{const l={order_id:h.ID};await P.post("https://dhya.one/hht/merchant/payment/paymentfailed",l,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}}),y.error("Payment failed. Please try again."),c(!0),r(!0),window.scrollTo(0,0)}catch(l){console.error("Error in calling payment failure API:",l),y.error("Failed to handle payment failure.")}finally{g(!1)}},Se=async(h,t,c,r,g,l,x,u,j,_,N,o,S,w,z,O,$)=>{const Q=String(t.razorpay_order_id),D=String(t.currency||"INR"),C=g.find(i=>i.ID===l);if(!await h()){y.error("Failed to load Razorpay SDK. Please try again later."),$(!1);return}const B={key:c,amount:r,currency:D,name:"HHT Entertainment",description:"Purchase Description",image:"https://hiphoptamizha.com/assets/hhtlogo-C5v3yLtg.png",order_id:Q,handler:async i=>{await ve(i,t,x,j,_,N,u,r,o,S,w,z,$)},prefill:{name:(j==null?void 0:j.display_name)||"NA",email:_||"NA",contact:N||"NA"},notes:{address:`${(C==null?void 0:C.line1)||"NA"}, ${(C==null?void 0:C.line2)||"NA"}, ${C.city||"NA"}, ${C.state||"NA"}, ${C.country||"NA"}`,phone:N||"NA",cart_items:u.map(i=>{var E,F;return`${(E=i==null?void 0:i.product)==null?void 0:E.name}, Size: ${(F=i==null?void 0:i.product_variant)==null?void 0:F.variant_size}, Qty: ${i==null?void 0:i.quantity}`}).join(", ")},theme:{color:"#3399cc"},modal:{ondismiss:async()=>{$(!1),await we(t,x,o,S,$)}}},R=new window.Razorpay(B);R.on("payment.failed",async i=>{}),R.open()},Pe=()=>{const{removeFromCart:h,setCart:t,cartId:c}=m.useContext(me),[r,g]=m.useState([]),{userDetails:l}=he(),x=(l==null?void 0:l.addresses)||[],[u,j]=m.useState(null),[_,N]=m.useState(!1),[o,S]=m.useState(!0),[w,z]=m.useState(null),[O,$]=m.useState(null),[Q,D]=m.useState(null),[C,H]=m.useState(!1),[B,R]=m.useState(!1),[i,E]=m.useState(null),[F,ee]=m.useState({userName:"",userEmail:"",cartItems:[],grandTotal:0,referenceNumber:""}),[Y,U]=m.useState(!1),[d,I]=m.useState({name:"",contact_no:"",email:"",address:"",landmark:"",city:"",pincode:"",state:"",country:"India",category:"Home"}),k=localStorage.getItem("access_token"),[be,J]=m.useState(!1);m.useEffect(()=>{(l==null?void 0:l.status)==="guest"?J(!0):J(!1)},[l]);const q="https://dhya.one/hht",se=async()=>{try{const s=await P.get(`${q}/merchant/cart/${c}`,{headers:{Authorization:`Bearer ${k}`}});g(s.data.data.items),S(!1)}catch(s){console.error("Error fetching cart data:",s),y.error("Failed to fetch cart items."),S(!1)}},ae=()=>{localStorage.setItem("address",JSON.stringify(d)),j(d),E(d.ID),N(!1),y.success("Address saved successfully!")},ne=async s=>{if(s.quantity>=10){y.error("Quantity should not exceed beyond 10.");return}z(s.ID);try{const a=s.quantity+1;await P.put(`${q}/merchant/cartItem/${s.ID}`,{ID:s.ID,quantity:a},{headers:{Authorization:`Bearer ${k}`}}),g(r.map(f=>f.ID===s.ID?{...f,quantity:a}:f))}catch(a){console.error("Error increasing quantity:",a),y.error("Failed to increase quantity.")}finally{z(null)}},te=async s=>{if(s.quantity<=1){y.error("Quantity cannot be less than 1.");return}$(s.ID);try{const a=s.quantity-1;await P.put(`${q}/merchant/cartItem/${s.ID}`,{ID:s.ID,quantity:a},{headers:{Authorization:`Bearer ${k}`}}),g(r.map(f=>f.ID===s.ID?{...f,quantity:a}:f))}catch(a){console.error("Error decreasing quantity:",a),y.error("Failed to decrease quantity.")}finally{$(null)}},re=async s=>{D(s);try{await P.delete(`${q}/merchant/cartItem/${s}`,{headers:{Authorization:`Bearer ${k}`}}),g(r.filter(a=>a.ID!==s))}catch(a){console.error("Error removing item from cart:",a),y.error("Failed to remove item.")}finally{D(null)}},L=r.reduce((s,a)=>s+a.price*a.quantity,0);m.useEffect(()=>{c&&se()},[c]),m.useEffect(()=>{if(x.length>0){const s=x.find(a=>a.is_primary);s?(j(s),E(s.ID)):(j(x[0]),E(x[0].ID))}else j(null),E(null)},[x]);const ce=()=>new Promise(s=>{const a=document.createElement("script");a.src="https://checkout.razorpay.com/v1/checkout.js",a.onload=()=>{s(!0)},a.onerror=()=>{s(!1)},document.body.appendChild(a)}),K=async()=>{var s,a,f,T;if(!u){y.error("Please select an address before proceeding.");return}try{U(!0);const b=localStorage.getItem("access_token"),V=L+(L>0?199:0),W=await Ne(c,{id:c,total_price:V},b);if(W.data.status==="success"){const oe={cart_id:W.data.data.ID,billing_address_id:i,shipping_address_id:i,shipping_rate:199},X=await Ce(oe,b),le=(a=(s=X.data)==null?void 0:s.data)==null?void 0:a.order,ie=(T=(f=X.data)==null?void 0:f.data)==null?void 0:T.razor_key;await Se(ce,le,ie,V*100,x,i,b,r,l,emailContact,phoneContact,R,setPaymentAttempted,H,ee,t,U)}}catch(b){console.error("Error in payment flow:",b),y.error(b.message),U(!1)}};return e.jsxs(M,{fluid:!0,className:"cartContainer",children:[e.jsx(pe,{backgroundColor:"#3EA66B",color:"#F4E003",name:"Cart"}),o?e.jsx(v,{className:"d-flex justify-content-center align-items-center my-5",children:e.jsx(p,{className:"d-flex justify-content-center align-items-center",children:e.jsx(G,{className:"loadingSpinner"})})}):r.length>0?e.jsxs(M,{children:[e.jsx(v,{className:"mt-3 d-flex justify-content-center justify-content-sm-end align-items-center",children:e.jsxs(p,{xs:12,className:"addressColumn d-flex justify-content-between align-items-center my-3",children:[e.jsx("div",{className:"deliverContainer p-0 m-0 w-100",children:e.jsxs("p",{className:"p-0 m-0 deliverText",children:["Deliver to: ",u?`${u.name}, ${u.address}, ${u.city}, ${u.pincode}`:"No address selected"]})}),e.jsx("div",{className:"changeAddressContainer",children:e.jsx("p",{className:"changeAddressText",onClick:()=>N(!0),children:u?"Change Address":"Add Address"})})]})}),r.map(s=>{var a,f,T,b;return e.jsx(ue.Fragment,{children:e.jsx(v,{className:"my-3 d-flex justify-content-center align-items-center",children:e.jsx(p,{xs:12,className:"cartImageRow",children:e.jsxs(v,{children:[e.jsx(p,{xs:4,lg:3,className:"cartImageColumn",children:e.jsx("div",{className:"cartImageContainer",children:((f=(a=s==null?void 0:s.product)==null?void 0:a.images)==null?void 0:f.length)>0?e.jsx(ye,{fluid:!0,src:s.product.images[0].image_url,alt:"product-image",className:"crtImage"}):null})}),e.jsxs(p,{xs:6,lg:7,className:"cartDetails m-0 p-0",children:[e.jsx("p",{className:"cartprName p-0 m-0",children:(T=s==null?void 0:s.product)==null?void 0:T.name}),e.jsxs("div",{className:"d-flex justify-content-start align-items-center w-100 my-1",children:[e.jsx("div",{className:"ssSizeContainer d-flex align-items-center",children:e.jsxs("p",{className:"m-0 p-0",children:["Size: ",(b=s==null?void 0:s.product_variant)==null?void 0:b.variant_size]})}),e.jsxs("div",{className:"ssSizeContainer d-flex align-items-center",children:[e.jsx("p",{className:"m-0 p-0",children:"Qty"}),e.jsxs("div",{className:"d-flex align-items-center justify-content-between ms-2",children:[e.jsx("p",{className:"m-0 px-1 actionicon",onClick:()=>te(s),children:O===s.ID?e.jsx(G,{className:"loadingSpinner"}):"-"}),e.jsx("p",{className:"m-0 px-1",children:s.quantity}),e.jsx("p",{className:"m-0 px-1 actionicon",onClick:()=>ne(s),children:w===s.ID?e.jsx(G,{className:"loadingSpinner"}):"+"})]})]})]}),e.jsxs("p",{className:"cartprprice p-0 m-0 mt-1 mt-md-3 d-flex justify-content-start align-items-center",children:["₹",s==null?void 0:s.price]})]}),e.jsx(p,{xs:2,lg:2,className:"cartDetailsIcon d-flex align-items-start justify-content-end",children:Q===s.ID?e.jsx(G,{className:"loadingSpinner"}):e.jsx(xe,{className:"closeIcon",onClick:()=>re(s.ID)})})]})})})},s.ID)}),e.jsxs(v,{className:"my-4 d-flex justify-content-center align-items-center",children:[e.jsx(p,{xs:12,className:"cartPriceRow",children:e.jsx("h4",{className:"pricedetailtext",children:"Price Details"})}),e.jsxs(p,{xs:12,className:"cartPriceRow",children:[e.jsxs("div",{className:"cartTotalContainer d-flex align-items-center justify-content-between mx-2",children:[e.jsx("p",{children:"Cart Total"}),e.jsxs("p",{children:["₹",L]})]}),e.jsxs("div",{className:"cartTotalContainer d-flex align-items-center justify-content-between mx-2",children:[e.jsx("p",{children:"Shipping Charges"}),e.jsx("p",{children:"₹199"})]}),e.jsxs("div",{className:"totalAmountContainer d-flex align-items-center justify-content-between mx-2",children:[e.jsx("p",{children:"Total Amount"}),e.jsxs("p",{children:["₹",L+199]})]})]})]}),e.jsx(v,{className:"my-3 d-flex justify-content-center align-items-center",children:e.jsx(p,{xs:12,className:"d-flex justify-content-center align-items-center",children:e.jsx("button",{className:"paymentProductButton",onClick:K,disabled:Y,children:Y?e.jsx(je,{animation:"border",size:"sm"}):"Proceed to Payment"})})}),C&&e.jsx(fe,{show:C,onHide:()=>H(!1),paymentDetails:F}),B&&e.jsx(ge,{show:B,onHide:()=>R(!1),onTryAgain:K}),e.jsxs(A,{show:_,onHide:()=>N(!1),children:[e.jsx(A.Header,{closeButton:!0,children:e.jsx(A.Title,{children:"Change Address"})}),e.jsx(A.Body,{children:e.jsxs(n,{children:[e.jsxs(n.Group,{controlId:"formName",children:[e.jsx(n.Label,{children:"Name"}),e.jsx(n.Control,{type:"text",placeholder:"Enter name",value:d.name,onChange:s=>I({...d,name:s.target.value})})]}),e.jsxs(n.Group,{controlId:"formContactNo",children:[e.jsx(n.Label,{children:"Contact Number"}),e.jsx(n.Control,{type:"text",placeholder:"Enter contact number",value:d.contact_no,onChange:s=>I({...d,contact_no:s.target.value})})]}),e.jsxs(n.Group,{controlId:"formEmail",children:[e.jsx(n.Label,{children:"Email"}),e.jsx(n.Control,{type:"email",placeholder:"Enter email",value:d.email,onChange:s=>I({...d,email:s.target.value})})]}),e.jsxs(n.Group,{controlId:"formAddress",children:[e.jsx(n.Label,{children:"Address"}),e.jsx(n.Control,{type:"text",placeholder:"Enter address",value:d.address,onChange:s=>I({...d,address:s.target.value})})]}),e.jsxs(n.Group,{controlId:"formCity",children:[e.jsx(n.Label,{children:"City"}),e.jsx(n.Control,{type:"text",placeholder:"Enter city",value:d.city,onChange:s=>I({...d,city:s.target.value})})]}),e.jsxs(n.Group,{controlId:"formPincode",children:[e.jsx(n.Label,{children:"Pincode"}),e.jsx(n.Control,{type:"text",placeholder:"Enter pincode",value:d.pincode,onChange:s=>I({...d,pincode:s.target.value})})]}),e.jsxs(n.Group,{controlId:"formState",children:[e.jsx(n.Label,{children:"State"}),e.jsx(n.Control,{type:"text",placeholder:"Enter state",value:d.state,onChange:s=>I({...d,state:s.target.value})})]}),e.jsxs(n.Group,{controlId:"formCountry",children:[e.jsx(n.Label,{children:"Country"}),e.jsx(n.Control,{type:"text",value:d.country,disabled:!0})]})]})}),e.jsxs(A.Footer,{children:[e.jsx(Z,{variant:"secondary",onClick:()=>N(!1),children:"Close"}),e.jsx(Z,{variant:"primary",onClick:ae,children:"Save Address"})]})]})]}):e.jsx(M,{fluid:!0,className:"cartContainer",children:e.jsx(v,{className:"d-flex justify-content-center align-items-center my-5",children:e.jsx(p,{className:"d-flex justify-content-center align-items-center",children:e.jsx("p",{className:"npcText",children:"No products in the cart."})})})})]})};export{Pe as default};
